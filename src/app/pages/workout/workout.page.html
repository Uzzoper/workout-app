<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/dashboard"></ion-back-button>
        </ion-buttons>
        <ion-title>{{ workout?.name || 'Carregando...' }}</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
    <div *ngIf="isLoading" class="ion-text-center ion-padding">
        <ion-spinner></ion-spinner>
        <p>Carregando treino...</p>
    </div>

    <div *ngIf="!isLoading && workout">
        <ion-card>
            <ion-card-header>
                <ion-card-title>{{ workout.name }}</ion-card-title>
                <ion-card-subtitle *ngIf="workout.scheduled_date">
                    {{ workout.scheduled_date | date:'dd/MM/yyyy' }}
                </ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
                <p *ngIf="workout.description">{{ workout.description }}</p>

                <ion-button expand="block" (click)="editWorkout()">
                    <ion-icon name="create" slot="start"></ion-icon>
                    Editar Treino
                </ion-button>

                <ion-button expand="block" color="danger" (click)="deleteWorkout()">
                    <ion-icon name="trash" slot="start"></ion-icon>
                    Deletar Treino
                </ion-button>
            </ion-card-content>
        </ion-card>

        <h2>Exercícios</h2>

        <div *ngIf="exercises.length > 0" class="exercises-list">
            <ion-card *ngFor="let exercise of exercises" (click)="toggleExercise(exercise.id)" class="exercise-card"
                [class.expanded]="isExpanded(exercise.id)">

                <ion-card-header>
                    <ion-card-title>
                        {{ exercise.name }}
                        <ion-icon [name]="isExpanded(exercise.id) ? 'chevron-up' : 'chevron-down'"
                            slot="end"></ion-icon>
                    </ion-card-title>
                    <ion-card-subtitle>
                        <ion-badge color="primary">{{ exercise.sets }} séries</ion-badge>
                        <ion-badge color="secondary">{{ exercise.reps }} reps</ion-badge>
                        <ion-badge color="tertiary" *ngIf="exercise.weight">{{ exercise.weight }}kg</ion-badge>
                    </ion-card-subtitle>
                </ion-card-header>

                <ion-card-content *ngIf="isExpanded(exercise.id)">
                    <div class="exercise-details">
                        <p *ngIf="exercise.rest_time">
                            <ion-icon name="time-outline"></ion-icon>
                            Descanso: {{ exercise.rest_time }} segundos
                        </p>
                        <p *ngIf="exercise.notes">
                            <ion-icon name="document-text-outline"></ion-icon>
                            {{ exercise.notes }}
                        </p>
                    </div>

                    <div class="action-buttons">
                        <ion-button fill="clear" color="primary"
                            (click)="editExercise(exercise); $event.stopPropagation()">
                            <ion-icon name="create" slot="start"></ion-icon>
                            Editar
                        </ion-button>
                        <ion-button fill="clear" color="danger"
                            (click)="deleteExercise(exercise); $event.stopPropagation()">
                            <ion-icon name="trash" slot="start"></ion-icon>
                            Excluir
                        </ion-button>
                    </div>
                </ion-card-content>
            </ion-card>
        </div>

        <div *ngIf="exercises.length === 0" class="ion-text-center ion-padding">
            <ion-icon name="fitness" size="large"></ion-icon>
            <p>Nenhum exercício cadastrado</p>
            <ion-button (click)="addExercise()">Adicionar primeiro exercício</ion-button>
        </div>
    </div>

    <ion-refresher slot="fixed" (ionRefresh)="loadWorkout($event)">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <ion-fab slot="fixed" vertical="bottom" horizontal="end">
        <ion-fab-button (click)="addExercise()">
            <ion-icon name="add"></ion-icon>
        </ion-fab-button>
    </ion-fab>
</ion-content>